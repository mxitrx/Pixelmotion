<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πà‡∏≤/‡∏£‡πâ‡∏≤‡∏ô</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>


  <div class="payment-container container">
    <h1>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>

    <form id="paymentForm" novalidate>
      <div class="form-group">
        <label for="fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input id="fullname" name="fullname" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞" required>
      </div>

      <div class="form-group">
        <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
        <input id="phone" name="phone" type="tel" placeholder="0812345678" pattern="[0-9+ -]{7,20}" required>
      </div>

      <div class="form-group">
        <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input id="email" name="email" type="email" placeholder="you@example.com">
      </div>

      <div class="form-group">
        <label for="item">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
        <select id="item" name="item" required>
          <option value="" disabled selected>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
        </select>
      </div>
      <div class="form-group">
        <label for="amount">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ö‡∏≤‡∏ó)</label>
        <input id="amount" name="amount" type="number" min="0" step="any" placeholder="0.00" required oninput="updateSummary()">
      </div>

      <div class="form-group">
        <label for="note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏≠‡∏≤. ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πà‡∏≤)</label>
        <textarea id="note" name="note" rows="3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
      </div>

      <div class="summary" id="summary">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: 0.00 ‡∏ö‡∏≤‡∏ó</div>

      <button type="submit" id="submitBtn" class="confirm-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </form>
    
    <div id="result"></div>
  </div>

  <div class="navbar">
    <a href="index.html">üè†<span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></a>
    <a href="track.html" class="active">üìã<span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></a>
    <a href="profile.html">üë§<span>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</span></a>
  </div>

  <script src="products.js"></script>
  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxFxzJfM1GZjc1HsvGLpsUYYSRLQj59WFKz-wWsW-bpxRpQrlyme_k8SILvPFZ-FCJF/exec"; // <-- ‡πÉ‡∏™‡πà URL ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy

    const form = document.getElementById('paymentForm');
    const paymentContainer = document.querySelector('.payment-container');
    const submitBtn = document.getElementById('submitBtn');
    const resultDiv = document.getElementById('result');
    const summaryDiv = document.getElementById('summary');
    const amountInput = document.getElementById('amount');
    const itemSelect = document.getElementById('item');

    document.addEventListener('DOMContentLoaded', () => {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Dropdown
      products.forEach(product => {
        const option = document.createElement('option');
        option.value = product.name;
        option.textContent = `${product.name} (${product.priceText})`;
        option.dataset.price = product.price;
        itemSelect.appendChild(option);
      });

      // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const selectedItem = urlParams.get('item');
      if (selectedItem) {
        itemSelect.value = selectedItem;
        // Trigger change event to update price
        itemSelect.dispatchEvent(new Event('change'));
      }
    });

    itemSelect.addEventListener('change', (event) => {
        const selectedOption = event.target.options[event.target.selectedIndex];
        const price = selectedOption.dataset.price;
        if (price) {
          amountInput.value = price;
          updateSummary();
        }
      });

    function updateSummary() {
      const amount = parseFloat(amountInput.value) || 0;
      summaryDiv.textContent = `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${amount.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó`;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      submitBtn.disabled = true;
      submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      resultDiv.style.display = 'none';

      const formData = new FormData(form);
      
      fetch(SCRIPT_URL, { method: 'POST', body: formData })
      .then(response => response.json())
      .then(data => {
        if (data.result === "success") {
          paymentContainer.innerHTML = `
            <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
            <p>‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong></p>
            <p style="font-size: 1.5rem; color: var(--primary-color); background: var(--dark-bg); padding: 10px; border-radius: 8px;">${data.transactionId}</p>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</p>
            <a href="track.html" class="confirm-btn" style="display: block; text-align: center; margin-top: 20px;">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
          `;
        } else {
          throw new Error(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
        }
      })
      .catch(error => {
        resultDiv.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
        resultDiv.className = 'error';
        resultDiv.style.display = 'block';
        submitBtn.disabled = false;
        submitBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      });
    });

    updateSummary();
  </script>

</body>
</html>